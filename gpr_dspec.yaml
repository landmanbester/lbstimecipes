_include:
  - (jove)stimela_cabs.yaml

opts:
  log:
    dir: logs
    nest: 2

gpr_dspec:
  name: GPR-DSPEC
  info: Smooth all four Stokes parameters simultaneously using GPR
  for_loop:
    var: stokes
    over: ['I', 'Q', 'U', 'V']
    scatter: 4

  inputs:
    basename:
      dtype: str
      required: true
      info:
        Basename of file to smooth eg. to smooth ABC123.fits.I.norm.fits
        pass in ABC123.fits
    mad_threshold:
      dtype: float
      default: 2.5
      aliases: ["*.mad_threshold"]
      info:
        Multiple of the MAD value to flag eg. anything outside of
        (median - mad_threshold * MAD < val < median + mad_threshold * MAD)
        will be flagged.
    lnu:
      dtype: float
      default: 0.01
      aliases: ["*.lnu"]
      info:
        Degree of smoothing in freq direction.
        Must be in [0, 1) with 0 -> no smoothing.
    lt:
      dtype: float
      default: 0.001
      aliases: ["*.lt"]
      info:
        Degree of smoothing in time direction.
        Must be in [0, 1) with 0 -> no smoothing.
    nthreads:
      dtype: int
      default: 8
      aliases: ["*.nthreads"]
      info:
        Number of threads per Stokes product.
    t0:
      dtype: int
      default: 0
      aliases: ["*.t0"]
      info:
        Start time
    tf:
      dtype: int
      default: -1
      aliases: ["*.tf"]
      info:
        End time
    nu0:
      dtype: int
      default: 0
      aliases: ["*.nu0"]
      info:
        Start freq
    nuf:
      dtype: int
      default: -1
      aliases: ["*.nuf"]
      info:
        End freq

  steps:
    smooth:
      cab: gpr_smooth
      params:
        basename: '{recipe.basename}.{recipe.stokes}.norm.fits'
